<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customized Farm Fields Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <script>
        let data = [11990, 11766, 12438, 13580, 13918, 12960, 13079, 13669, 14851, 13287, 12635, 11838, 11918, 12535, 11674, 10791, 11577, 12895, 13127, 13713, 12918, 12429, 12962, 11791, 12389, 11916, 12149, 12019, 11510, 11034, 13321, 13750, 15319, 15826, 14924, 13815, 13240, 12050, 11056, 12185, 12434, 12436, 12912, 14819, 14329, 13277, 13440, 14080, 13574, 12205, 12005, 11665, 11859, 12245, 12457, 12241, 13360, 13840, 14121, 12604, 12241, 12649, 12728, 11922, 12088, 11676, 11894, 12279, 12318, 13220, 13800, 13559, 14930, 14275, 13235, 12511, 12111, 11382, 10912, 11707, 12225, 13004, 14470, 14168, 14500, 13802, 12704, 11659, 11939, 11938, 11269, 11335, 13090, 12979, 12761, 12446, 13344, 13204, 13890, 12333, 12350, 12403, 12755, 11834, 11675, 11707, 12907, 13437, 13044, 13685, 13069, 13141, 13887, 12962, 12486, 12375, 10863, 10744, 11557, 12043, 13552, 13795, 15401, 15406, 14093, 12913, 12687, 12547];

function setup() {
    createCanvas(800, 800);
    noLoop();
}

function draw() {
    background(255);
    drawFields();
    saveCanvas('farmFields', 'png');
}

function drawFields() {
    for (let i = 0; i < 128; i++) {
        let num = data[i];
        let size = ((num % 10) || 10) * 30 + 100;
        size = constrain(size, 100, 400);
        let sides = max(Math.floor((num % 100) / 10), 3);
        let bezierDist = (Math.floor((num % 1000) / 100) || 1) * 15 + 50;
        bezierDist = constrain(bezierDist, 50, 200);
        let offset = (Math.floor(num / 1000) || 1) * 19 + 10;
        offset = constrain(offset, 10, 200);

        let x = random(size / 2, width - size / 2);
        let y = random(size / 2, height - size / 2);

        drawField(x, y, size, sides, bezierDist, offset);
    }
}

function drawField(x, y, size, sides, bezierDist, offset) {
    let vertices = [];
    let angleStep = TWO_PI / sides;

    for (let angle = 0; angle < TWO_PI; angle += angleStep) {
        let vx = x + cos(angle) * size / 2;
        let vy = y + sin(angle) * size / 2;
        vertices.push(createVector(vx, vy));
    }

    // Draw the white-filled polygon first
    fill(255);
    noStroke();
    beginShape();
    for (let v of vertices) {
        vertex(v.x, v.y);
    }
    endShape(CLOSE);

    // Create a clipping mask
    let fieldMask = createGraphics(width, height);
    fieldMask.fill(255);
    fieldMask.noStroke();
    fieldMask.beginShape();
    for (let v of vertices) {
        fieldMask.vertex(v.x, v.y);
    }
    fieldMask.endShape(CLOSE);

    // Select a random boundary point
    let edgeIndex = floor(random(sides));
    let nextEdgeIndex = (edgeIndex + 1) % sides;
    let edgeStart = vertices[edgeIndex];
    let edgeEnd = vertices[nextEdgeIndex];
    let t = random(0.1, 0.9);
    let boundaryPoint = p5.Vector.lerp(edgeStart, edgeEnd, t);

    // Find the farthest point
    let maxDist = 0;
    let farthestPoint;
    for (let v of vertices) {
        let d = p5.Vector.dist(boundaryPoint, v);
        if (d > maxDist) {
            maxDist = d;
            farthestPoint = v;
        }
    }

    // Calculate perpendicular line
    let perpVector = createVector(-(farthestPoint.y - boundaryPoint.y), farthestPoint.x - boundaryPoint.x);
    perpVector.setMag(maxDist);
    let perpPoint1 = p5.Vector.add(farthestPoint, perpVector);
    let perpPoint2 = p5.Vector.sub(farthestPoint, perpVector);

    // Draw bezier curves
    let curveGraphics = createGraphics(width, height);
    drawBezierCurves(curveGraphics, boundaryPoint, perpPoint1, perpPoint2, bezierDist, offset);

    // Apply mask
    curveGraphics.loadPixels();
    fieldMask.loadPixels();
    for (let i = 0; i < curveGraphics.pixels.length; i += 4) {
        if (fieldMask.pixels[i] == 0) {
            curveGraphics.pixels[i + 3] = 0;
        }
    }
    curveGraphics.updatePixels();

    // Draw the bezier curves
    image(curveGraphics, 0, 0);

    // Draw field outline
    noFill();
    stroke(0);
    strokeWeight(1);
    beginShape();
    for (let v of vertices) {
        vertex(v.x, v.y);
    }
    endShape(CLOSE);
}

function drawBezierCurves(pg, startPoint, endPoint1, endPoint2, bezierDist, offset) {
    let numCurves = floor(random(10, 20));  // Increased number of curves
    let spacing = 1 / numCurves;

    for (let i = 0; i < numCurves; i++) {
        let t = lerp(0, 1, i * spacing + random(-spacing / 4, spacing / 4));
        let endPoint = p5.Vector.lerp(endPoint1, endPoint2, t);

        let controlOffset1 = p5.Vector.random2D().mult(offset / 3);  // Slightly reduced offset
        let controlOffset2 = p5.Vector.random2D().mult(offset / 3);  // Slightly reduced offset

        pg.stroke(255, 0, );  // Added some transparency

        pg.noFill();
        pg.bezier(
            startPoint.x, startPoint.y,
            startPoint.x + controlOffset1.x, startPoint.y + controlOffset1.y,
            endPoint.x + controlOffset2.x, endPoint.y + controlOffset2.y,
            endPoint.x, endPoint.y
        );
    }
}



    </script>
</body>
</html>
