<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customized Farm Fields Visualization with Bezier Effects</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <script>
        let data = [11990, 11766, 12438, 13580, 13918, 12960, 13079, 13669, 14851, 13287, 12635, 11838, 11918, 12535, 11674, 10791, 11577, 12895, 13127, 13713, 12918, 12429, 12962, 11791, 12389, 11916, 12149, 12019, 11510, 11034, 13321, 13750, 15319, 15826, 14924, 13815, 13240, 12050, 11056, 12185, 12434, 12436, 12912, 14819, 14329, 13277, 13440, 14080, 13574, 12205, 12005, 11665, 11859, 12245, 12457, 12241, 13360, 13840, 14121, 12604, 12241, 12649, 12728, 11922, 12088, 11676, 11894, 12279, 12318, 13220, 13800, 13559, 14930, 14275, 13235, 12511, 12111, 11382, 10912, 11707, 12225, 13004, 14470, 14168, 14500, 13802, 12704, 11659, 11939, 11938, 11269, 11335, 13090, 12979, 12761, 12446, 13344, 13204, 13890, 12333, 12350, 12403, 12755, 11834, 11675, 11707, 12907, 13437, 13044, 13685, 13069, 13141, 13887, 12962, 12486, 12375, 10863, 10744, 11557, 12043, 13552, 13795, 15401, 15406, 14093, 12913, 12687, 12547];

        function setup() {
            createCanvas(800, 800);
            noLoop(); // 只绘制一次
        }

        function draw() {
            background(255); // 白色背景
            drawFields();
            saveCanvas('farmFields', 'png'); // 保存画布为PNG文件
        }

        function drawFields() {
            for (let i = 0; i < 128; i++) {
                let num = data[i];
                let size = (num % 10) * 30 + 100;
                size = constrain(size, 100, 400);
                let sides = Math.floor((num % 100) / 10);
                sides = max(sides, 3);
                let bezierDist = (Math.floor((num % 1000) / 100)) * 15 + 50;
                bezierDist = constrain(bezierDist, 50, 200);
                let offset = (Math.floor(num / 1000)) * 19 + 10;
                offset = constrain(offset, 10, 200);

                let x = random(50, width - 50 - size);
                let y = random(50, height - 50 - size);

                drawField(x, y, size, sides, bezierDist, offset);
            }
        }

        function drawField(x, y, size, sides, bezierDist, offset) {
            let vertices = [];
            let angleStep = TWO_PI / sides;
            for (let angle = 0; angle < TWO_PI; angle += angleStep) {
                let vx = x + cos(angle) * size / 2;
                let vy = y + sin(angle) * size / 2;
                vertices.push(createVector(vx, vy));
            }

            // 绘制农田区域
            fill(0); // 使用黑色填充
            stroke(0);
            strokeWeight(1);
            beginShape();
            for (let v of vertices) {
                vertex(v.x, v.y);
            }
            endShape(CLOSE);

            // 创建遮罩绘制贝塞尔曲线
            let mask = createGraphics(width, height);
            mask.fill(255);
            mask.stroke(255, 0, 0); // 红色
            mask.strokeWeight(2);
            mask.beginShape();
            vertices.forEach(v => mask.vertex(v.x, v.y));
            mask.endShape(CLOSE);

            // 选择一个边界点和最远的点
            let boundaryIndex = floor(random(sides));
            let boundaryPoint = vertices[boundaryIndex];
            let farthestPoint = boundaryPoint;
            let maxDist = 0;
            vertices.forEach(v => {
                let d = dist(boundaryPoint.x, boundaryPoint.y, v.x, v.y);
                if (d > maxDist) {
                    maxDist = d;
                    farthestPoint = v;
                }
            });

            // 计算垂直于连接线的向量
            let perp = createVector(farthestPoint.y - boundaryPoint.y, -(farthestPoint.x - boundaryPoint.x));
            perp.setMag(bezierDist);

            // 绘制贝塞尔曲线
            mask.bezier(boundaryPoint.x, boundaryPoint.y,
                        boundaryPoint.x + perp.x, boundaryPoint.y + perp.y,
                        farthestPoint.x + perp.x, farthestPoint.y + perp.y,
                        farthestPoint.x, farthestPoint.y);

            // 应用遮罩
            fill(255);
            stroke(0);
            strokeWeight(1);
            beginShape();
            for (let v of vertices) {
                vertex(v.x, v.y);
            }
            endShape();
            image(mask, 0, 0);
        }
    </script>
</body>
</html>
